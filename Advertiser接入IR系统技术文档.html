<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<style>
h1,
h2,
h3,
h4,
h5,
h6,
p,
blockquote {
    margin: 0;
    padding: 0;
}
body {
    font-family: "Helvetica Neue", Helvetica, "Hiragino Sans GB", Arial, sans-serif;
    font-size: 13px;
    line-height: 18px;
    color: #737373;
    background-color: white;
    margin: 10px 13px 10px 13px;
}
table {
	margin: 10px 0 15px 0;
	border-collapse: collapse;
}
td,th {	
	border: 1px solid #ddd;
	padding: 3px 10px;
}
th {
	padding: 5px 10px;	
}

a {
    color: #0069d6;
}
a:hover {
    color: #0050a3;
    text-decoration: none;
}
a img {
    border: none;
}
p {
    margin-bottom: 9px;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    color: #404040;
    line-height: 36px;
}
h1 {
    margin-bottom: 18px;
    font-size: 30px;
}
h2 {
    font-size: 24px;
}
h3 {
    font-size: 18px;
}
h4 {
    font-size: 16px;
}
h5 {
    font-size: 14px;
}
h6 {
    font-size: 13px;
}
hr {
    margin: 0 0 19px;
    border: 0;
    border-bottom: 1px solid #ccc;
}
blockquote {
    padding: 13px 13px 21px 15px;
    margin-bottom: 18px;
    font-family:georgia,serif;
    font-style: italic;
}
blockquote:before {
    content:"\201C";
    font-size:40px;
    margin-left:-10px;
    font-family:georgia,serif;
    color:#eee;
}
blockquote p {
    font-size: 14px;
    font-weight: 300;
    line-height: 18px;
    margin-bottom: 0;
    font-style: italic;
}
code, pre {
    font-family: Monaco, Andale Mono, Courier New, monospace;
}
code {
    background-color: #fee9cc;
    color: rgba(0, 0, 0, 0.75);
    padding: 1px 3px;
    font-size: 12px;
    -webkit-border-radius: 3px;
    -moz-border-radius: 3px;
    border-radius: 3px;
}
pre {
    display: block;
    padding: 14px;
    margin: 0 0 18px;
    line-height: 16px;
    font-size: 11px;
    border: 1px solid #d9d9d9;
    white-space: pre-wrap;
    word-wrap: break-word;
}
pre code {
    background-color: #fff;
    color:#737373;
    font-size: 11px;
    padding: 0;
}
sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}
* {
	-webkit-print-color-adjust: exact;
}
@media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:10px auto;
    }
}
@media print {
	body,code,pre code,h1,h2,h3,h4,h5,h6 {
		color: black;
	}
	table, pre {
		page-break-inside: avoid;
	}
}
</style>
<title>角色</title>

</head>
<body>
<p><code>文档处于不断地更新和完善的过程中，我们会把各个Advertiser接入过程中遇到的各种问题记录下来并分享给所有的Advertiser。</code></p>

<h3>角色</h3>

<p><a href="http://www.extrabux.com/">Extrabux</a>是Media Partner，电商网站/转运公司是Advertiser，<a href="http://www.impactradius.com/">Impact Radius</a>(以下简称IR)是广告联盟。Extrabux和Advertiser通过IR系统联系在一起。</p>

<h3>业务</h3>

<p>概括来说就是Extrabux为Advertiser带去流量和用户，用户在Advertiser上产生一个转化行为后，Advertiser支付一笔佣金给Extrabux，然后Extrabux再将佣金的绝大部分返还给用户。</p>

<ul>
<li><h6>注册返利</h6>

<p>Extrabux每成功推荐一个用户在Advertiser上注册，Advertiser返还给Extrabux一笔固定金额的佣金，Extrabux再将佣金的绝大部分返还给用户。</p></li>
<li><h6>充值返利</h6>

<p>Extrabux引导用户去Advertiser上充值，Advertiser将用户的充值金额的一定比例作为佣金返还给Extrabux，Extrabux再将佣金的绝大部分返还给用户。</p></li>
<li><h6>下单返利</h6>

<p>Extrabux引导用户去Advertiser上消费，用户在Advertiser上产生消费行为后，Advertiser将用户的订单金额<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>的一定比例<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>作为佣金返还给Extrabux，Extrabux再将佣金的绝大部分返还给用户。</p></li>
</ul>


<p>IR在Extrabux和Advertiser中间起到桥梁的作用。</p>

<p>佣金的形式、数额由Extrabux和Advertiser约定好并在IR进行配置，双方不产生任何直接的行为交互和资金流动。它们各自做自己的事情并和IR打交道，由IR作为媒介来串起整个流程。</p>

<h3>流程细节</h3>

<ol>
<li>用户在Extrabux上登录</li>
<li>点击目标Advertiser的Ad</li>
<li><p>Extrabux调用IR提供的此Ad的url并传入当前用户的标识信息</p>

<blockquote><p>Extrabux和IR之间的交互至此结束，Advertiser无须关心以上流程。下面进入IR和Advertiser之间的交互。</p></blockquote></li>
<li><p>IR引导用户进入此Ad url对应的Advertiser提供的入口页面<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup>，并传入此次Ad click event的惟一标识和来源标识，即clickid<sup id="fnref:4"><a href="#fn:4" rel="footnote">4</a></sup>和irmpname<sup id="fnref:5"><a href="#fn:5" rel="footnote">5</a></sup>。<br/>
Extrabux的irmpname是<code>Extrabux Shanghai</code>。在后台对irmpname做equals的时候请注意，<code>Extrabux Shanghai</code>中间是有个空格的，虽然在跳转的过程中会被浏览器转义成<code>+</code>号，但你们的框架在把它从request中解析出来后应该仍然是空格。<br/>
Advertiser须将这两个参数<sup id="fnref:6"><a href="#fn:6" rel="footnote">6</a></sup>保存到cookie里并设置一定的有效期(一般半个月即可)，因为不知道用户成功转化需要多长时间。</p></li>
<li><p>用户成功转化后，Advertiser回传数据给IR。建议Advertiser将clickid、irmpname和订单/运单信息关联起来，方便以后自己做查询统计；并对回传成功的记录打上标记，以便失败后重传。<br/>
回传的数据内容主要包括：CampaignId、ActionTrackerId、ClickId、Oid、EventDate、Amount、Currency等<sup id="fnref:7"><a href="#fn:7" rel="footnote">7</a></sup>。<br/>
以下是各个参数的说明。</p>

<ul>
<li><code>CampaignId</code>：固定值，每个ActionTracker均使用相同的CampaignId，在对ActionTracker做测试时就可以看到。</li>
<li><code>ActionTrackerId</code>：固定值，每个ActionTracker的id都不一样，在对ActionTracker做测试时就可以看到。</li>
<li><code>ClickId</code>：第4步中IR传入的参数</li>
<li><code>Oid</code>：即Order Id，能惟一标识此次交易的id，建议直接使用订单/运单id，一来方便用户在Extrabux中查看<sup id="fnref:8"><a href="#fn:8" rel="footnote">8</a></sup>，二来便于以后数据有问题时对账。</li>
<li><code>EventDate</code>：交易完成的时间点，如订单/运单成功支付的时间点。格式：<code>dd-MMM-yyyy hh:mm:ss z</code>，如<code>21-Oct-2015 18:25:59 HKT</code><sup id="fnref:9"><a href="#fn:9" rel="footnote">9</a></sup>。小时请使用<code>24小时制</code>，因为在有些编程语言中<code>mm</code>表示的是12小时制，而<code>MM</code>表示的却是24小时制。此外，<code>z</code>在不同的编程语言中代表的意思也可能不一样，请换成你所使用的编程语言中能格式化成三个字母的用以代表时区的标识。</li>
<li><code>Amount</code>：订单/运单金额。Advertiser可根据自身业务需求决定是否剔除优惠券、积分等内容。</li>
<li><code>Currency</code>：可选项。货币的缩写。如果Advertiser和用户之间的交易不是以美元来结算的，请设置此属性，如人民币的货币缩写为CNY<sup id="fnref:10"><a href="#fn:10" rel="footnote">10</a></sup>。因为IR默认是以美元来结算，设置Currency后，IR会自动根据当前汇率将Amount换算成美元。</li>
</ul>
</li>
<li>IR接收到数据后，出Reports给Advertiser和Extrabux看。数据的锁定期默认是15天(可修改)。在锁定期内，Advertiser可对数据进行修正、Approve、Reverse等；锁定期一过，意味着Advertiser认可交易数据，IR随后会将佣金转给Extrabux。</li>
<li>Extraubx收到佣金后再与用户进行结算。</li>
</ol>


<p>到此，流程完毕。</p>

<h3>数据回传方式</h3>

<p>不同的数据回传方式是在创建Action Tracker时的Tracking Method属性中指定的，创建后无法更改。Action Tracker可以按照字面意思自己理解，Advertiser可创建N多个Action Tracker来trace各种不同的action，如注册、充值、下单等。</p>

<h6>以下是几种常用的Tracking Method：</h6>

<ul>
<li><p>Pixel<br/>
这是一种在交易完成时实时<sup id="fnref:11"><a href="#fn:11" rel="footnote">11</a></sup>回传数据的方式。它通过在网页里嵌入JavaScript代码的方式来回传数据。一般不适用于交易完成后的状态可能会发生变化的情况，如订单取消等。<br/>
更多信息请参考文档<a href="http://support.impactradius.com/display/ADVERTISER/JavaScript+Conversion+Code">JavaScript Conversion Code</a>。</p></li>
<li><p>Batch FTP<br/>
这是一种通过上传数据文件到IR的FTP服务器来回传数据的方式。IR接受两种格式的数据文件：XML和CSV。推荐使用可读性更强的XML格式。各个编程语言都有FTP client可以使用。<br/>
创建此类型的Action Tracker时点击<code>Email FTP Username and Password</code>按钮， IR会把FTP服务器的用户名/密码发到Advertiser的注册邮箱里。<br/>
那何时触发FTP上传动作呢？以转运公司为例，一般可选择在交易状态已基本稳定的时间点进行，如包裹出库时立即上传此运单的数据，或者定时触发，如一天上传一次，这时数据文件里一般会包含多笔运单的数据。<br/>
XML格式数据样例：</p>

<h6>Conversion Request</h6>

<pre><code>  &lt;?xml version="1.0" encoding="UTF-8"?&gt;
  &lt;ConversionRequests xmlns="http://ws.impactradius.com/ws/definitions"&gt;
      &lt;ConversionRequest&gt;
          &lt;CampaignId&gt;3141&lt;/CampaignId&gt;
          &lt;ActionTrackerId&gt;8232&lt;/ActionTrackerId&gt;
          &lt;ClickId&gt;3AiWUu2QnUtyxPe3eRX0LVC9UkXWJ6UlqxHu2U0&lt;/ClickId&gt;
          &lt;Oid&gt;OT-201510191230&lt;/Oid&gt;
          &lt;Amount&gt;99&lt;/Amount&gt;
          &lt;EventDate&gt;19-Oct-2015 12:36:30 HKT&lt;/EventDate&gt;
          &lt;Currency&gt;CNY&lt;/Currency&gt;        
      &lt;/ConversionRequest&gt;
      &lt;ConversionRequest&gt;
          ...
      &lt;/ConversionRequest&gt;  
      &lt;ConversionRequest&gt;
          ...
      &lt;/ConversionRequest&gt; 
      ...... 
  &lt;/ConversionRequests&gt;
</code></pre>

<h6>Items Conversion Request</h6>

<pre><code>  &lt;?xml version="1.0" encoding="UTF-8"?&gt;
  &lt;ItemConversionRequests xmlns="http://ws.impactradius.com/ws/definitions"&gt;
      &lt;ItemConversionRequest&gt;
          &lt;CampaignId&gt;3141&lt;/CampaignId&gt;
          &lt;ActionTrackerId&gt;8232&lt;/ActionTrackerId&gt;
          &lt;ClickId&gt;3AiWUu2QnUtyxPe3eRX0LVC9UkXWJ6UlqxHu2U0&lt;/ClickId&gt;
          &lt;Oid&gt;OT-201510191230&lt;/Oid&gt;
          &lt;CustomerId&gt;40111728&lt;/CustomerId&gt;
          &lt;EventDate&gt;19-Oct-2015 12:36:30 HKT&lt;/EventDate&gt;
          &lt;Currency&gt;CNY&lt;/Currency&gt;
          &lt;Items&gt;
              &lt;Item&gt;
                  &lt;Sku&gt;sku-40892&lt;/Sku&gt;
                  &lt;Category&gt;cat-1002&lt;/Category&gt;
                  &lt;Quantity&gt;1&lt;/Quantity&gt;
                  &lt;Amount&gt;29.00&lt;/Amount&gt;
              &lt;/Item&gt;
              &lt;Item&gt;
                  &lt;Sku&gt;sku-1373&lt;/Sku&gt;
                  &lt;Category&gt;cat-3002&lt;/Category&gt;
                  &lt;Quantity&gt;2&lt;/Quantity&gt;
                  &lt;Amount&gt;36&lt;/Amount&gt;
              &lt;/Item&gt;
          &lt;/Items&gt;
      &lt;/ItemConversionRequest&gt;
      &lt;ItemConversionRequest&gt;
          ...
      &lt;/ItemConversionRequest&gt;        
      &lt;ItemConversionRequest&gt;    
          ...
      &lt;/ItemConversionRequest&gt;
      ......    
  &lt;/ItemConversionRequests&gt;
</code></pre>

<p><code>重要提示1</code>：The Item data needs to be ordered first by OrderId, then Item SKU. If records are out of order, the items will be viewed as duplicate orders and only the first item will count.<br/>
<code>重要提示2</code>：请务必将样例中的CampaignId和ActionTrackerId替换成你们自己的。<br/>
Items Conversion Request一般用于电商网站；Conversion Request则一般用于转运公司。当然，如果Advertiser想把一个运单也当作一件Item的话，用Items Conversion Request也无妨。<br/>
数据文件上传成功后，Advertiser的注册邮箱里会收到一封IR发出的标题为<code>Data Submission Received</code>的邮件，里面是对此次上传的数据的处理结果。Batch Details中Failure为False时数据才算上传成功。
数据文件默认是上传到根目录下的，Advertiser无须考虑创建不同的文件夹来管理上传的数据文件，IR也没说允许这么做。<br/>
更多信息请参考文档：<a href="http://support.impactradius.com/display/ADVERTISER/Batch+FTP+Tracking+Method">Batch FTP Tracking Method</a>、<a href="http://support.impactradius.com/display/ADVERTISER/Guide+-+Tracking+Integration#Guide-TrackingIntegration-AdvertiserFTPConversionReportingMethodforOnlineActions">Advertiser FTP Conversion Reporting Method</a></p></li>
<li><p>Web Services<br/>
这里的Web Services不是通常意义上的Web Service，其实它就是个HTTP REST API。各个编程语言都有HTTP Client可以使用。<br/>
请详细阅读文档<a href="http://support.impactradius.com/display/ADVERTISER/Web+Services+Tracking">Web Services Tracking</a>中关于<code>authenticate</code>的内容。AccountSid和authentication token可以从<a href="https://member.impactradius.com/secure/advertiser/accountSettings/techintegration/adv-wsapi-flow.ihtml?execution=e2s1">这里</a>获得。<br/>
更多信息请参考文档：<a href="http://support.impactradius.com/display/ADVERTISER/Web+Services+Tracking">Web Services Tracking</a>、<a href="http://dev.impactradius.com/display/api/Conversions">API-Conversions</a>  <br/>
<code>纠错</code>：在文档<a href="http://support.impactradius.com/display/ADVERTISER/Web+Services+Tracking">Web Services Tracking</a>中Conversions的api接口</p>

<pre><code>  https://api.impactradius.com/2010-09-01/Advertisers/{AccountSid}/Conversions
</code></pre>

<p>是错误的。正确的应该是</p>

<pre><code>  https://api.impactradius.com/Advertisers/{AccountSid}/Conversions
</code></pre>

<p>调用Web Services API成功后类似的返回信息：</p>

<pre><code>  &lt;ImpactRadiusResponse&gt;
      &lt;Status&gt;QUEUED&lt;/Status&gt;
      &lt;QueuedUri&gt;/Advertisers/{AccountSid}/BatchSummaries/XysrtIBGGA&lt;/QueuedUri&gt; 
  &lt;/ImpactRadiusResponse&gt;
</code></pre>

<p>失败时类似的返回信息：</p>

<pre><code>  &lt;ImpactRadiusResponse&gt;
      &lt;Status&gt;ERROR&lt;/Status&gt;
      &lt;Message&gt;Validation Failed&lt;/Message&gt;
      &lt;Errors&gt;
          &lt;Error&gt;
              &lt;Field&gt;CampaignId&lt;/Field&gt;
              &lt;Message&gt;Invalid value xyz&lt;/Code&gt;
          &lt;/Error&gt;
      &lt;/Errors&gt;        
  &lt;/ImpactRadiusResponse&gt;
</code></pre></li>
</ul>


<h3>Action Tracker</h3>

<p>为各种不同的action定义相应的tracker。<br/>
创建Action Tracker请到<a href="https://member.impactradius.com/secure/advertiser/campaign/actiontracker/view-actiontracker-flow.ihtml?execution=e1s1">这里</a>。此页面会列出所有已经创建好的的Action Tracker，欲创建新的Action Tracker请点击<code>Create Action Tracker</code>按钮。<br/>
前期在Advertiser不熟悉IR的情况下可由Extrabux协助创建Action Tracker，但我们希望后面Advertiser能够自己来掌控Action Tracker，毕竟这是IR里经常用到的功能。</p>

<p>下面我们重点说一下Action Tracker的测试。<code>在开始测试之前请Advertiser确保你们的开发人员已经拿到了IR系统的账号</code>。</p>

<h6>Action Tracker的测试</h6>

<p>点击要测试的Action Tracker的<code>Actions</code>按钮，然后选择<code>Test</code>。<br/>
如果您测试的是Pixel类型的Action Tracker，请先选择<code>Tracking Code</code>来获取要埋入到页面里的JavaScript代码，然后再点击页面下方的<code>Continue To Testing</code>即可进入到测试页面。下面是一段JavaScript脚本样例，请认真对待里面的注释内容。</p>

<pre><code>&lt;!-- Impact Radius Tracking Code.
Removal or modification of this code will disrupt marketing activities. This code is property of Impact Radius, please do not remove or modify without first contacting Impact Radius Technical Services.
--&gt;
&lt;script type="text/javascript" src="//d33wwcok8lortz.cloudfront.net/js/3141/8324/irv3.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript"&gt;
    // required advertiser supplied values
    irEvent.setOrderId("Your Order Id here");

    // At least one item is necessary.  The parameters are
    // cat: A category, for example "electronics".  Required
    // sku: A unique product identifier, or Storage Keeping Unit
    // amt: The total sale amount for this line item.  Required
    // qty: The quantity of the line item.  Required.
    irEvent.addItem("electronics", "220-2300", "112000.00", "56");  // 56 identical gizmos at 2000.00 each
    irEvent.setCurrency("CNY"); //可选项，请参考前面对Currency字段的描述。

    irEvent.fire();
&lt;/script&gt;
</code></pre>

<p>细心的同学可能注意到了，这里面回传的参数与我们在流程细节里描述的不一致，根本就没有CampaignId、ActionTrackerId、ClickId和EventDate等参数。是的，在Pixel方式里的确不用显式的传入这些参数，IR会通过其他形式自己获取到。比如，页面加载的"/js/3141/8324/irv3.js"文件里就包含了CampaignId和ActionTrackerId；ClickId在传给你的入口页面之前IR就已经以其他方式保存到自己的cookie里了，当irEvent.fire()的时候就会带过去，同时呢，EventDate也有了。</p>

<p>测试流程大同小异，我们以Web Service方式为例： <br/>
<img src="http://7xnrpy.com1.z0.glb.clouddn.com/web-service-test-page.png" alt="web-service-test-page" />
你需要的<code>CampaignId</code>、<code>ActionTrackerId</code>、<code>ClickId</code>都有了。<br/>
Landing Page URL就是我们上面提到的入口页面。这里有个小技巧。当技术人员在本地完成所有的开发工作后，可直接在测试页面对本地项目进行测试，无须部署到线上之后再测，这样可以避免因为一些小问题而频繁的上线。请把Landing Page URL中的域名改成你本地的地址，如127.0.0.1之类的，irmpname参数的值可直接替换成<code>Extrabux Shanghai</code>，clickid参数的值IR会自动替换成上面的Test Key。点击<code>Start Test in New Window</code>按钮后启动测试，页面里随之会出现一个loading条，IR在等待你回传数据给它。<br/>
<code>注意事项</code>：当你使用FTP或Web Service的方式来回传数据时，因为EventDate是显式设置的，不像在Pixel方式里是由IR隐式获得的，所以要特别注意它的值。EventDate的限制条件：<code>必须是在Click Date之后且不能是一个未来的时间</code>。Click Date是IR产生clickid的那个时间点，也就是你进入到上图所示的页面的那个时间点。假设这个时间点大约是"19-Oct-2015 12:36:30 HKT"，回传动作发生的时间点大约是"19-Oct-2015 12:42:09 HKT"，那在你回传的数据里EventDate的值必须在这两个时间点之间。</p>

<p>为了方便开发理解，我使用了Chrome浏览器的Postman插件来回传数据，截图在<a href="http://7xnrpy.com1.z0.glb.clouddn.com/web-service-back-data-to-ir.png">这里</a>。<br/>
当IR收到回传的数据后，测试页面会进入到<code>Complete a Conversion</code>，如下图所示<img src="http://7xnrpy.com1.z0.glb.clouddn.com/web-service-data-view.png" alt="" /><br/>
在此页面中校验下IR接收到的数据和你回传的是否一致，如果一致，请挨个<code>Correct</code>，然后点击页面下方的<code>Validate</code>(也有可能是<code>Activate Action Tracker</code>)按钮来激活此Action Tracker。回到列表页面后可以发现此Action Tracker的<code>Test Status</code>已经变成<code>Successful</code>了。</p>

<h4><code>请一定要记得激活Action Tracker，不然无法进行后续的流程</code></h4>

<p>Action Tracker的测试到此完成。下面会进入到创建Ad和设置Insertion Order，此部分可先由Extrabux代为操作，但我们仍是希望Advertiser在对IR有一定了解后自己去掌控这些事情。</p>

<h3>Ads</h3>

<p>一个Ad创建好后Advertiser可以将它发送给一个或多个或所有的Media Partner<sup id="fnref:12"><a href="#fn:12" rel="footnote">12</a></sup>，每个Media Parnter得到的Ad url都不一样。入口页面的url也是在Ad里设置的。</p>

<h3>Insertion Orders</h3>

<p>An insertion order is an agreement between a Media Partner and an Advertiser that governs the relationship between the two parties. The Insertion Order contains the terms of the agreement such as payout rates, cookie duration, lead caps, action validation period, return policies, call center hours and all other terms that may be relevant to the partnership. 更多信息请参考<a href="https://help.impactradius.com/hc/en-us/articles/210895837-Insertion-Orders">Insertion-Orders</a><br/>
设置Media Partner和Advertiser之间的协议条款。包含但不限于以下几点：返利是百分比还是固定的金额，百分比是多少，固定金额又是多少；从一个Ad click产生到最终完成交易的最长时间间隔；action的锁定期，默认就是上面说过的15天；同一个clickid产生的前几笔交易是有效(返利)的，默认是前3笔<sup id="fnref:13"><a href="#fn:13" rel="footnote">13</a></sup>。<br/>
Advertiser可就同一项业务与不同的Media Partner签订不同的协议内容。Advertiser将某个Insertion Order发送给特定的Media Partner，Media Partner接受后双方建立起联系。</p>

<h3>全了</h3>

<p>Ads和Insertion Order设置好后，整个流程就通了。<br/>
简单回顾一下。用户在Extrabux上点一个广告(Ad)，Extrabux(或者是其他的Media Partner)知道要将用户导向到哪个Ad url，IR记录下这个Ad click event然后再将用户导向Advertiser提供的对应的入口页面，Advertiser记录下IR传入的参数，用户在Advertiser的网站上成功转化，Advertiser回传数据给IR，IR收到后根据Insertion Order计算佣金然后给到Extrabux。Extrabux再将佣金的绝大部分返还给用户。</p>

<h3>线上模拟测试</h3>

<p>这里的线上指的是<code>生产环境</code>。<br/>
做线上模拟测试的必要性是因为本地和线上是两个完全不同的环境，本地能跑通的程序到了线上未必也能跑通，如果中间哪个环节存在问题，那么提前暴露出来并解决掉要比正式提供给用户使用后再回来修复所带来的影响要小的多。做线上模拟测试的困难程度对各个Advertiser来说可能不一样，但这个步骤不能省。  <br/>
Action Tracker在本地测试通过后由Advertiser部署程序到线上，Angie将对应的Ad url给到Advertiser的技术人员，然后双方可各自进行线上模拟测试。线上模拟测试会省略掉Extrabux到IR的部分，直接从访问Ad url开始。对于Advertiser是转运公司的情况，还需要转运公司能模拟入库、支付、出库等动作。<br/>
IR接收到数据后一般20分钟内就可以在<a href="https://member.impactradius.com/secure/advertiser/actions/open/pending-actions-flow.ihtml?execution=e12s1">Pending Actions</a>里看到，而在<a href="https://member.impactradius.com/secure/advertiser/Adv_Campaign_Dashboard/r11/report/viewReport.report?handle=adv_generation_foundation_campaign_dashboard">Reports</a>里看到至少需要2+小时。</p>

<h6><code>注意事项</code></h6>

<p>在做线上模拟测试前，请Angie和Advertiser的技术人员再三确认以下几点：<br/>
1. Action Tracker是否已Validated<br/>
2. Ad的landing page是否设置正确<br/>
3. Angie将Ad url给到Advertiser的技术人员</p>

<h6>Pending Actions</h6>

<p>在action的锁定期内，Advertiser可以对其进行数据修正、Approve、Reverse等操作。对于线上模拟测试的数据，可以在Reverse中选择<code>Test Action</code>。<br/>
如果有大量数据需要Reverse可以选择调用Web Services接口或上传数据文件到FTP服务器的方式来批量操作，详情请查看<a href="http://support.impactradius.com/display/ADVERTISER/Understanding+Batch+Reporting+of+Conversion+Returns">这里</a>。更多关于Pending Actions的文档请查看<a href="http://support.impactradius.com/display/ADVERTISER/FAQs+-+Pending+Actions">FAQs-Pending Actions</a></p>

<h3>小问题集锦</h3>

<p>Advertisers在实践中会遇到各种各样的小问题，在文档上方的流程细节中无法一一覆盖到，所以我们以问题集锦的方式列出。<br/>
1. 在对Action Tracker测试时，数据已经回传给了IR，但是在Action Trackers列表页面中对应的Test Status却是<code>System Invalidated</code>。<br/>
原因：可能是因为你回传的ActionTrackerId和当前测试的action tracker的id不一致造成的。 <br/>
2. 在做线上模拟测试时，数据明明已经回传给了IR，过了一段时间后却仍然在Pending Actions里看不到。<br/>
原因：极有可能是EventDate的问题。这里我们再重申一下EventDate的限制条件，它<code>必须是在Click Date之后且不能是一个未来的时间</code>。Click Date是IR产生clickid的那个时间点，正常情况下EventDate肯定是在Click Date之后的，但是怕就怕在对EventDate做格式化的时候格错。格式化字符串<code>dd-MMM-yyyy hh:mm:ss z</code>是一个整体，不能先把EventDate格式化成<code>dd-MMM-yyyy hh:mm:ss</code>后再加上所在的timezone的缩写。如果你使用的编程语言本身(如C#，但C#有第三方库可以做到)不支持格式化出包含timezone缩写的形式，那折衷方案是先把EventDate格式化成UTC时间的字符串然后再拼接上<code>GMT</code>(注意GMT前有个空格)来表示使用的时区是GMT。<br/>
3. <code>Amount</code>表示的是订单/运单金额，请Advertiser不要误认为它是你们给到Extrabux的返点金额(或者叫佣金)，返点金额(佣金)应该给Extrabux多少是由IR来计算的，Advertiser无须关心。</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>订单金额里可能包含优惠券、积分等内容，Advertiser可根据自身的业务需求来决定是否剔除它们。<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
<li id="fn:2">
<p>也可以是固定金额的佣金。<a href="#fnref:2" rev="footnote">&#8617;</a></p></li>
<li id="fn:3">
<p>这里虽然说的是入口页面，但其实只要有个后台就行了，不需要真的有对应的页面。因为它只要能接收click和irmpname参数，然后写到cookie里，然后直接302重定向到首页或其他页面就行了。而且强烈建议在这个后台做302重定向，不然一长串的参数在地址栏里确实不好看。它的职责就是接收IR传入的参数，参数处理完后就重定向到想去的页面。<a href="#fnref:3" rev="footnote">&#8617;</a></p></li>
<li id="fn:4">
<p>每次Ad click都会产生一个惟一的clickid，它是字母、数字和一些符号的组合。<a href="#fnref:4" rev="footnote">&#8617;</a></p></li>
<li id="fn:5">
<p>Impact Radius Media Partner Name<a href="#fnref:5" rev="footnote">&#8617;</a></p></li>
<li id="fn:6">
<p>IR内置的其他参数和Advertiser可自定义的参数请参考<a href="https://member.impactradius.com/secure/advertiser/campaign/technicalintegration-flow.ihtml?execution=e1s1">Campaign Settings -> Online Traffic Settings -> Show advanced settings -> Query String Parameters</a><a href="#fnref:6" rev="footnote">&#8617;</a></p></li>
<li id="fn:7">
<p>更多的可选项请参考<a href="http://support.impactradius.com/display/ADVERTISER/Batch+FTP+Tracking+Method#BatchFTPTrackingMethod-Fields">文档</a><a href="#fnref:7" rev="footnote">&#8617;</a></p></li>
<li id="fn:8">
<p>是的。Advertiser回传给IR的数据IR同样也会给到Extrabux，Extrabux再显示给用户看。真实有效的Order Id可以让用户很方便的和Advertiser里的订单/运单对应起来。<a href="#fnref:8" rev="footnote">&#8617;</a></p></li>
<li id="fn:9">
<p>时区缩写请参考<a href="https://en.wikipedia.org/wiki/List_of_time_zone_abbreviations">time_zone_abbreviations</a>。如果你们系统使用的是中国标准时间，请不要使用CST来表示，因为CST可表示多个时区，而且在IR里也的确不用于表示Chinese Standard Time。请改用HKT(Hong Kong Time)。<a href="#fnref:9" rev="footnote">&#8617;</a></p></li>
<li id="fn:10">
<p>货币缩写请参考<a href="http://www.currency-iso.org/dam/downloads/lists/list_one.xml">currency-iso</a><a href="#fnref:10" rev="footnote">&#8617;</a></p></li>
<li id="fn:11">
<p>Batch FTP和Web Services这两种tracking method是延后回传数据。<a href="#fnref:11" rev="footnote">&#8617;</a></p></li>
<li id="fn:12">
<p>体会到irmpname参数的用处了吧<a href="#fnref:12" rev="footnote">&#8617;</a></p></li>
<li id="fn:13">
<p>尽管如此，Extrabux和Advertiser最好还是引导用户每次下单前都从Extrabux点过去，理想状况是一个clickid对应一笔交易。<a href="#fnref:13" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

</body>
</html>